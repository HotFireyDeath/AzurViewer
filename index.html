<!DOCTYPE html>

<!-- 
AzurViewer
[ A web explorer for Azur Lane. Look at detailed ship stats, descriptions and more. ]

Developed by Chen Zheng (@HotFireyDeath)
http://czheng.me
-->

<html>
<head>
    <title>AzurViewer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
          integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <!-- MATERIALIZE -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <style>
        body {
            font-family: "Open Sans", serif;
        }

        /*
            Below is a solution to fit an image to the page responsively.
            The solution can be found at:
            https://stackoverflow.com/a/14696457
        */
        * {
            margin: 0;
            padding: 0;
        }

        .imgbox {
            display: grid;
            height: 100%;
        }

        .center-fit {
            max-width: 100%;
            max-height: 100vh;
            margin: auto;
        }
    </style>
</head>
<body>

<nav id="omnisearch" style="display: none;">
    <div class="nav-wrapper blue darken-1">
        <form>
            <div class="input-field">
                <input id="search" type="search" placeholder="Type 'help' for navigation options">
                <label class="label-icon" for="search"><i class="fas fa-search"></i></label>
                <i class="material-icons fas fa-times" onclick="$('#search').val('');"></i>
            </div>
        </form>
    </div>
</nav>

<div class="container">
    <ul class="collection" id="search_results" style="display: none;"></ul>
</div>

<div id="loading_pleaseWait">
    <div class="container">
        <div class="card horizontal">
            <div class="card-image">
                <img id="loading_pleaseWait_char" src="https://azurlane.koumakan.jp/w/images/f/fb/SaratogaChibi.png">
            </div>
            <div class="card-stacked">
                <div class="card-content" style="text-align: center;" id="loading_pleaseWait_phrase">
                    <span id="loading_pleaseWait_percentage" style="font-size: 10px;"></span>
                    <span class="card-title">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="ship_displayCase" style="display: none;">
    <div class="container">
        <p id="ship_displayCase_rawData"></p> <!-- rawData div will only be filled for development purpose. -->
        <h4 id="ship_displayCase_name" style="text-align: center;" onclick="checkClick();"></h4>
        <div class="imgbox"><img onclick="displaySkinModal();" class="center-fit" id="ship_displayCase_skinpicture"
                                 src="https://azurlane.koumakan.jp/w/images/0/06/Akagi.png"></div>
        <ul class="collection">
            <li id="ship_displayCase_nationality" class="collection-item"></li>
            <li id="ship_displayCase_rarity" class="collection-item"></li>
            <li id="ship_displayCase_constructionTime" class="collection-item"></li>
            <li id="ship_displayCase_class" class="collection-item"></li>
            <li id="ship_displayCase_hullType" class="collection-item"></li>
            <li id="ship_displayCase_id" class="collection-item"></li>
            <li id="ship_displayCase_clickMiscInfo" class="collection-item"
                style="background-color: whitesmoke; cursor: pointer;" onclick="$('#miscInfoModal').modal('open');">
                <small>Click for misc. info</small>
            </li>
        </ul>
    </div>
</div>

<div id="skinModal" class="modal">
    <div class="modal-content">
        <h4>Select a skin: </h4>
        <ul class="collection" id="skinModal_list"></ul>
    </div>
</div>

<div id="miscInfoModal" class="modal">
    <div class="modal-content">
        <h4>Misc. Info</h4>
        <ul class="collection">
            <li id="miscInfoModal_artist" class="collection-item"></li>
            <li id="miscInfoModal_voiceActress" class="collection-item"></li>
        </ul>
    </div>
</div>

<script>

    // Development raw data name clicker.
    var devClicks = 0;

    function checkClick() {
        if (devClicks === 10) {
            $("#ship_displayCase_rawData").text(JSON.stringify(ship_db[document.title]));
            devClicks = 0;
        }
        else {
            devClicks++;
        }
    }

    // Set random loading character and 'slogan'.
    var loadingRandoms = {
        "https://azurlane.koumakan.jp/w/images/8/86/LaffeyChibi.png": "Commander... wait here (yawn)...",
        "https://azurlane.koumakan.jp/w/images/f/fb/SaratogaChibi.png": "Commander, please wait a moment~",
        "https://azurlane.koumakan.jp/w/images/0/08/AyanamiChibi.png": "Please wait a second, commander...",
        "https://azurlane.koumakan.jp/w/images/8/84/BelfastChibi.png": "Pardon me, Commander, but you will have to wait a second. In the meantime, would you like some tea?",
        "https://azurlane.koumakan.jp/w/images/7/70/AkashiChibi.png": "Commander, wait here while I examine the site meow...",
        "https://azurlane.koumakan.jp/w/images/e/e7/UnicornChibi.png": "Big brother... Unicorn will stay with you while you wait...",
        "https://azurlane.koumakan.jp/w/images/2/2c/Ning_HaiChibi.png": "I wonder if the fleet's expenses can be covered by this site...",
        "https://azurlane.koumakan.jp/w/images/f/f5/AjaxChibi.png": "My precious little piggy, let me step on your face~"
    };
    // This is a slightly modified version of the solution found here: https://stackoverflow.com/a/15106541
    var randomKey = function (loadingRandoms) {
        var keys = Object.keys(loadingRandoms);
        return keys[keys.length * Math.random() << 0];
    };
    randomKey = randomKey(loadingRandoms);
    $("#loading_pleaseWait_char").attr("src", randomKey);
    var phrase = $("#loading_pleaseWait_phrase");
    phrase.html(phrase.html() + loadingRandoms[randomKey]);


    // An object containing the URL to useful icons.
    var icons = {
        "firepower": "https://azurlane.koumakan.jp/w/images/thumb/d/d5/Firepower.png/25px-Firepower.png",
        "health": "https://azurlane.koumakan.jp/w/images/thumb/8/8b/Duration.png/25px-Duration.png",
        "anti_air": "https://azurlane.koumakan.jp/w/images/thumb/0/0f/AntiAir.png/25px-AntiAir.png",
        "evasion": "https://azurlane.koumakan.jp/w/images/thumb/d/d2/Evasion.png/25px-Evasion.png",
        "air_power": "https://azurlane.koumakan.jp/w/images/thumb/6/6a/Aviation.png/25px-Aviation.png",
        "aviation": "https://azurlane.koumakan.jp/w/images/thumb/6/6a/Aviation.png/25px-Aviation.png",
        "torpedo": "https://azurlane.koumakan.jp/w/images/thumb/4/40/Torpedo.png/25px-Torpedo.png"
    };

    // An object containing ALL ship data. This is a large variable.
    var ship_db = {};

    // An object containing ALL resource data. This is a fairly large variable.
    var resource_db = {};

    var searchTextCache = '';

    /**
     * Gets the index of the nth occurance of a substring in a string.
     * This solution was deprived from StackOverflow, original answer found here:
     * https://stackoverflow.com/a/14482123
     * */
    function nthIndex(str, pat, n) {
        var L = str.length, i = -1;
        while (n-- && i++ < L) {
            i = str.indexOf(pat, i);
            if (i < 0) break;
        }
        return i;
    }

    /**
     * Displays the skins for the current ship in a modal.
     */
    function displaySkinModal() {

        // Remove previous results (visual).
        var node = document.getElementById('skinModal_list');
        while (node.firstChild) {
            node.removeChild(node.firstChild);
        }

        // Search and list all skins.
        var shipName = document.title.replace(/ /g, "_");
        for (var fileName in resource_db) {
            if (
                (fileName.indexOf(shipName) !== -1) &&
                (fileName.indexOf('Chibi') === -1) &&
                (fileName.indexOf('Icon') === -1) &&
                (fileName.indexOf('Banner') === -1) &&
                (fileName.indexOf('Questline') === -1) &&
                (fileName.indexOf('head') === -1) &&
                (fileName.indexOf('Title') === -1) &&
                (fileName.indexOf('shopskin') === -1) &&
                (fileName.indexOf('Card') === -1) &&
                (fileName.indexOf('Emblem') === -1) &&
                (fileName.indexOf('event') === -1) &&
                (fileName.indexOf('Event_CN') === -1) &&
                (fileName.indexOf('Event_JP') === -1) &&
                (fileName.indexOf('Furniture') === -1) &&
                (fileName.indexOf('quest') === -1) &&
                (fileName.indexOf('Event') === -1) &&
                (fileName.indexOf('SBS') === -1) &&
                (fileName.indexOf('Skill') === -1) &&
                (fileName.indexOf('Defense') === -1) &&
                (fileName.indexOf('Ddskins') === -1) &&
                (fileName.indexOf('Offense') === -1) &&
                (fileName.indexOf('Support') === -1) &&
                (fileName.indexOf('plushie') === -1) &&
                (fileName.indexOf('33000') === -1) &&
                (fileName.indexOf('33060') === -1) &&
                (fileName.indexOf('91033') === -1) &&
                (fileName.indexOf('91133') === -1) &&
                (fileName.indexOf('skill') === -1) &&
                (fileName.indexOf('2200') === -1) &&
                (fileName.indexOf('42200') === -1) &&
                (fileName.indexOf('91022') === -1) &&
                (fileName.indexOf('91122') === -1) &&
                (fileName.indexOf('22000') === -1) &&
                (fileName.indexOf('22100') === -1) &&
                (fileName.indexOf('22200') === -1) &&
                (fileName.indexOf('22260') === -1) &&
                (fileName.indexOf('32200') === -1) &&
                (fileName.indexOf('Piccy1_mod5_neuerenderframe_s22a') === -1)
            ) {
                var extension = fileName.split('.').pop(); // gets the file extension.
                if (extension === 'png') {
                    var parent = document.getElementById('skinModal_list');
                    var child = document.createElement('LI');
                    child.className = 'collection-item';
                    child.innerHTML = '<a onclick="forceSkin(\'' + fileName + '\');" style="color: black; text-decoration: none; cursor: pointer;">' + fileName.replace('.png', ' ') + '</a>';
                    parent.appendChild(child);
                }
            }
        }

        // Display modal after all the work is done.
        var sm = $('#skinModal');
        sm.modal('open');
    }

    /**
     * Force loads a skin into the viewer given a file key.
     */
    function forceSkin(fileKey) {
        var sp = $("#ship_displayCase_skinpicture");
        sp.hide();
        sp.ready(function () {
            $("#ship_displayCase_skinpicture").show();
        });
        sp.attr("src", resource_db[fileKey]);

        // Since this method is only used for skin loading, close skin modal once processing.
        $('#skinModal').modal('close');
    }

    /**
     * Renders the ship display case with the given ship.
     */
    function renderShipDisplayCase(shipName) {

        document.title = shipName;

        // General display and name.
        $("#search").val("");
        var shipChunk = ship_db[shipName];
        $("#ship_displayCase").show();
        $("#ship_displayCase_name").html(shipName + " <small><small><small>(CN: " + shipChunk["detailedItems"]["CNName"] + "; JP: " + shipChunk["detailedItems"]["JPName"] + ")</small></small></small>");

        // Skin image
        var sp = $("#ship_displayCase_skinpicture");
        sp.hide();
        sp.ready(function () {
            $("#ship_displayCase_skinpicture").show();
        });
        sp.attr("src", resource_db[shipName.replace(/ /g, "_") + ".png"]);

        // Ship general attributes and misc info.
        var nationality = shipChunk["detailedItems"]["Nationality"];//detailedItems is more accurate to read from
        var rarity = shipChunk["detailedItems"]["Rarity"];
        var constructionTime = shipChunk["detailedItems"]["ConstructTime"];
        var clas = shipChunk["detailedItems"]["Class"];
        var hullType = shipChunk["detailedItems"]["Type"];
        var id = shipChunk["detailedItems"]["ID"];
        var nationalityColorTypes = {
            "Sakura Empire": "pink",
            "Eagle Union": "dodgerblue",
            "Royal Navy": "lightblue",
            "Ironblood": "lightcoral",
            "Eastern Radiance": "hotpink",
            "North Union": "lightgray",
            "Iris Libre": "gold",
            "Vichya Dominion": "italianred"
        };
        var rarityColorTypes = {
            "Normal": "lightgray",
            "Rare": "lightblue",
            "Elite": "mediumpurple",
            "Super Rare": "gold"
        };
        var n = $("#ship_displayCase_nationality");
        n.css("background-color", nationalityColorTypes[nationality]);
        n.html("<small>Nationality</small> " + nationality);
        var r = $("#ship_displayCase_rarity");
        r.css("background-color", rarityColorTypes[rarity]);
        r.html("<small>Rarity</small> " + rarity);
        $("#ship_displayCase_constructionTime").html("<small>Construction Time</small> " + constructionTime);
        $("#ship_displayCase_class").html("<small>Class</small> " + clas);
        $("#ship_displayCase_hullType").html("<small>Hull Type</small> " + hullType);
        $("#ship_displayCase_id").html("<small>ID</small> " + id);

        // Ship misc info modal.
        $('#miscInfoModal_artist').html("<small>Artist</small> <a target='_blank' href='" + shipChunk['detailedItems']['ArtistLink'].replace('[', '').replace(']', '').replace(shipChunk['detailedItems']['Artist'], '') +
            "'>" + shipChunk['detailedItems']['Artist'] + "</a>");
        var VAchunk = shipChunk['detailedItems']['VA']; // have to process this before putting into HTML.
        VAchunk = VAchunk.replace('[', '').replace(']', '').replace('https://en.wikipedia.org/wiki/', '');
        VAchunk = VAchunk.substring(0, VAchunk.indexOf(' '));
        VAchunk = decodeURIComponent(VAchunk);
        var VAlink = 'https://en.wikipedia.org/wiki/' + encodeURIComponent(VAchunk);
        $('#miscInfoModal_voiceActress').html("<small>Voice Actress</small> <a target='_blank' href='" + VAlink + "'>" + VAchunk.replace('_', ' ') + "</a>");
    }

    /**
     * Parses the list of ships given the wikimedia HTML parse data for https://azurlane.koumakan.jp/List_of_Ships.
     * This is hard-coded, and therefore is subject to breaking. Will attempt to update as often as possible.
     * Developed by @HotFireyDeath (Chen Zheng)
     * https://czheng.me
     */
    function parseListOfShips(data) {
        var ships = {};
        // Parse ship's 'top layer' data using List of Ships Azur Wiki result.
        for (var i = 0; i < data.length; i++) {
            if ((i + 1) < data.length) { // Check for out of bounds.
                if (
                    data[i].includes("td data-sort-value=") &&
                    data[i + 1].includes("a href=\"") &&
                    (isNaN(data[i + 1].substring(data[i + 1].indexOf(">") + 1)) || (parseInt(data[i + 1].substring(data[i + 1].indexOf(">") + 1)) < 3000))
                ) {
                    var shipName = (data[i + 1].substring(9, nthIndex(data[i + 1], "\"", 2))).replace(/_/g, " ");
                    ships[shipName] = {
                        pageLink: "/" + shipName.replace(/ /g, "_"), // Ship Wikimedia page
                        id: data[i + 1].substring(data[i + 1].indexOf(">") + 1), // Ship ID
                        category: data[i + 11].substring(data[i + 11].indexOf(">") + 1),
                        rarity: data[i + 8].substring(data[i + 8].indexOf(">") + 1),
                        affiliation: data[i + 15].substring(data[i + 15].indexOf(">") + 1),
                        firepower_rating: data[i + 18].substring(data[i + 18].indexOf(">") + 1),
                        health_rating: data[i + 20].substring(data[i + 20].indexOf(">") + 1),
                        anti_air_rating: data[i + 22].substring(data[i + 22].indexOf(">") + 1),
                        evasion_rating: data[i + 24].substring(data[i + 24].indexOf(">") + 1),
                        air_power_rating: data[i + 26].substring(data[i + 26].indexOf(">") + 1),
                        torpedo_rating: data[i + 28].substring(data[i + 28].indexOf(">") + 1)
                    }
                }
            }
        }
        localStorage.setItem('fullDataAmount', "0");
        localStorage.setItem('dataFetched', "0");
        // Deep search for each ship, grab available stats.
        for (var name in ships) {
            //var name = "Universal Bullin";
            var shipNameTag = ships[name]["pageLink"].substring(1);
            localStorage.setItem('fullDataAmount', (parseInt(localStorage.getItem('fullDataAmount')) + 1) + "");
            $.ajax({
                url: "https://azurlane.koumakan.jp/w/api.php",
                method: "GET",
                dataType: "jsonp",
                data: {
                    action: "parse",
                    page: shipNameTag,
                    prop: "wikitext",
                    format: "json"
                },
                success: function (data) {
                    localStorage.setItem('dataFetched', (parseInt(localStorage.getItem('dataFetched')) + 1) + "");
                    var raw = data["parse"]["wikitext"]["*"];
                    raw = raw.split("|");

                    // Reverse search ships by matching ID.
                    var currentShipID = raw[1].split("=")[1].trim();
                    for (var s in ships) {
                        if (ships[s]["id"] === currentShipID) {
                            ships[s]["detailedItems"] = {};
                            raw.forEach(function (item) {
                                var twig = item.split("=");
                                if (twig.length === 2) {
                                    // Remove format whitespacing.
                                    twig[0] = twig[0].trim();
                                    twig[1] = twig[1].trim();
                                    ships[s]["detailedItems"][twig[0]] = twig[1];
                                }
                            });
                        }
                    }
                }
            });

            // Separate ajax calls for images.
            localStorage.setItem('fullDataAmount', (parseInt(localStorage.getItem('fullDataAmount')) + 1) + "");
            $.ajax({
                url: "https://azurlane.koumakan.jp/w/api.php",
                method: "GET",
                dataType: "jsonp",
                data: {
                    action: "query",
                    list: "allimages",
                    ailimit: 300,
                    aifrom: shipNameTag,
                    aiprop: "url",
                    format: "json"
                },
                success: function (data2) {
                    localStorage.setItem('dataFetched', (parseInt(localStorage.getItem('dataFetched')) + 1) + "");
                    var allImages = data2["query"]["allimages"];
                    allImages.forEach(function (item) {
                        resource_db[item["name"]] = item["url"];
                    });
                }
            });
        }

        // Essentially, waits until the ajaxes (above) are done, and then saves the data.
        var interval = window.setInterval(function () {
            $("#loading_pleaseWait_percentage").text(Math.round((parseInt(localStorage.getItem('dataFetched')) / parseFloat(localStorage.getItem('fullDataAmount'))) * 100) + "% done");
            if (localStorage.getItem('dataFetched') === localStorage.getItem('fullDataAmount')) {

                // All data received, now parse and render.
                document.title = "AzurViewer";
                $("#loading_pleaseWait").hide();
                $("#omnisearch").show();
                ship_db = ships;

                clearInterval(interval);
            }
            else if ((document.readyState === "complete") && (localStorage.getItem('dataFetched') !== localStorage.getItem('fullDataAmount'))) {
                alert("Unable to fetch data. Retrying...");
                location.reload();
            }
        }, 500);
    }

    $.ajax({
        url: "https://azurlane.koumakan.jp/w/api.php",
        method: "GET",
        dataType: "jsonp",
        data: {
            action: "parse",
            page: "List_of_Ships",
            format: "json"
        },
        success: function (data) {
            // text variable contains a fragment of HTML.
            var text = data['parse']['text']['*'];
            text = text.split("<");
            parseListOfShips(text);
        }
    });

    // Makes the search results appear and disappear as search is focused.
    window.setInterval(function () {
        var search = $("#search");
        if (search.is(":focus") && (search.val().length > 0)) {
            $("#search_results").show();
            $("#ship_displayCase").hide();
            document.title = "AzurViewer";
            devClicks = 0;
            $("#ship_displayCase_rawData").text("");
        }
        else {
            $("#search_results").hide();
        }
    }, 500);

    // Search functionality (WIP)
    window.setInterval(function () {

        var omnisearch = $("#search").val();
        var searchResult = $('#search_results');

        if (omnisearch !== searchTextCache) {
            searchTextCache = omnisearch;
            // clear current results
            var node = document.getElementById("search_results");
            while (node.firstChild) {
                node.removeChild(node.firstChild);
            }

            // Get the object keys from ship object (searching indexes).
            var searchKeywords = Object.keys(ship_db['Ayanami']);
            // Remove detailed items array key.
            var index = searchKeywords.indexOf('detailedItems');
            if (index !== -1) searchKeywords.splice(index, 1);
            // Combine detailedItems keys as well.
            searchKeywords = searchKeywords.concat(Object.keys(ship_db['Ayanami']['detailedItems']));
            var searchByKeyword = '', keywordDetected = false;
            searchKeywords.forEach(function (item) {
                if (omnisearch.indexOf(item + ":") === 0) {
                    // A search keyword is detected.
                    searchByKeyword = item;
                    keywordDetected = true;
                }
            });

            if (omnisearch.length > 0) {
                if (keywordDetected) {
                    // Special keyword search. seasrchByKeyword should be defined as an object key.
                    // Attempt to detect if the property is from 'detailedItems'

                    // First, though, notify the user that we are searching by special keyword.
                    var searchTarget = omnisearch.substring(searchByKeyword.length + 1).trim();
                    var notify = $('<li></li>');
                    notify.addClass('collection-item');
                    notify.html('<b>Searching by ' + searchByKeyword + ' ... (' + searchTarget + ')</b>');
                    searchResult.append(notify);
                    var addition = $('<li></li>');
                    addition.addClass('collection-item');
                    addition.html('<i>For a full list of searchable components, click <a onclick="$(\'#search\').val(\'allsearchablecomponents\');" style="cursor:pointer;">here</a>.</i>');
                    searchResult.append(addition);
                    if (searchByKeyword[0] === searchByKeyword[0].toUpperCase()) {
                        // first letter is uppercase, search inside detailedItems.
                        var shipNames = Object.keys(ship_db);
                        shipNames.forEach(function (name) {
                            if (ship_db[name]['detailedItems'][searchByKeyword].toLowerCase().indexOf(searchTarget.toLowerCase()) !== -1) {
                                var newListElement = $('<li></li>');
                                newListElement.addClass('collection-item');
                                newListElement.click(function () {
                                    renderShipDisplayCase(name);
                                });
                                newListElement.html('<a onclick="renderShipDisplayCase(\'' + name + '\')" style=\'color: black; text-decoration: none; cursor: pointer;\'>' + name + '</a>');
                                searchResult.append(newListElement);
                            }
                        });
                    }
                    else {
                        // same type of search, but perform outside detailedItems.
                        var shipNames = Object.keys(ship_db);
                        shipNames.forEach(function (name) {
                            if (ship_db[name][searchByKeyword].toLowerCase().indexOf(searchTarget.toLowerCase()) !== -1) {
                                var newListElement = $('<li></li>');
                                newListElement.addClass('collection-item');
                                newListElement.click(function () {
                                    renderShipDisplayCase(name);
                                });
                                newListElement.html('<a onclick="renderShipDisplayCase(\'' + name + '\')" style=\'color: black; text-decoration: none; cursor: pointer;\'>' + name + '</a>');
                                searchResult.append(newListElement);
                            }
                        });
                    }
                }
                else if (omnisearch.toLowerCase() === "help") {
                    var helpData = {
                        "regular search": "Enter text and search results will appear based on ship name.",
                        "compare": "Compares named ships' stats. <a onclick='$(\"#search\").val(\"compare prinz eugen, belfast, universal bullin\");' style='cursor: pointer;'>Click for an example</a>",
                        "allsearchablecomponents": "Gives a list of searchable keywords, with examples built in.",
                        "help": "Shows all possible commands."
                    };
                    for (var name in helpData) {
                        var newListElement = $("<li></li>");
                        newListElement.addClass('collection-item');
                        newListElement.html(name + " : " + helpData[name]);
                        searchResult.append(newListElement);
                    }
                }
                else if (omnisearch.toLowerCase() === 'allsearchablecomponents') {
                    var allComps = $('<li></li>');
                    allComps.addClass('collection-item');
                    allComps.html('<b>Search format is [component]: search. All searchable components: </b>');
                    searchResult.append(allComps);
                    searchKeywords.forEach(function (item) {
                        var c = $('<li></li>');
                        c.addClass('collection-item');
                        c.html('<i><a onclick="$(\'#search\').val(\'' + item + ': \');" style="cursor:pointer;">' + item + '</a></i>');
                        searchResult.append(c);
                    });
                }
                else if (omnisearch.toLowerCase().indexOf('compare') !== -1) {
                    var newListElement = $('<li></li>');
                    newListElement.addClass('collection-item');
                    newListElement.html("<b>Compare functionality currently not added. Please check back later.</b> ( O w O ) /");
                    searchResult.append(newListElement);
                }
                else {
                    var shipNames = Object.keys(ship_db);
                    shipNames.forEach(function (item) {
                        if (item.toLowerCase().indexOf(omnisearch.toLowerCase()) !== -1) {
                            // add to search_results
                            var newListElement = $('<li></li>');
                            newListElement.click(function () {
                                renderShipDisplayCase(item);
                            });
                            newListElement.css('cursor', 'pointer');
                            newListElement.addClass('collection-item');
                            newListElement.html("<a onclick='renderShipDisplayCase(\"" + item + "\")' style='color: black; text-decoration: none; cursor: pointer;'>" + item + "</a>");
                            searchResult.append(newListElement);
                        }
                    });
                }
            }
        }

    }, 500);

    // Prevent submitting and reloading the page (by pressing enter) with omnisearch.
    $('#search').keypress(function (event) {
        if (event.keyCode === 10 || event.keyCode === 13) {
            event.preventDefault();
        }
    });

    $('#skinModal').modal();
    $('#miscInfoModal').modal();
</script>
</body>
</html>
